<!DOCTYPE html><html lang="en"><head>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>JWT Auth with Counter</title>    <style>        body {            font-family: Arial, sans-serif;            max-width: 600px;            margin: 50px auto;            text-align: center;            padding: 20px;        }        input {            width: 90%;            padding: 10px;            margin: 10px 0;            border: 1px solid #ccc;            border-radius: 5px;        }        button {            padding: 10px;            width: 100%;            border: none;            background-color: #28a745;            color: white;            cursor: pointer;            margin: 10px 0;            border-radius: 5px;        }        button.logout {            background-color: #dc3545;        }        button.increment {            background-color: #007bff;            margin-bottom: 20px;        }        #message {            margin-top: 10px;            font-weight: bold;            color: #dc3545;        }        .token-display {            word-break: break-all;            background: #f8f9fa;            padding: 15px;            border-radius: 5px;            margin: 10px 0;            text-align: left;            font-family: monospace;        }        .counter {            font-size: 24px;            font-weight: bold;            margin: 20px 0;            padding: 10px;            background: #e9ecef;            border-radius: 5px;        }    </style></head><body><h2>JWT Authentication</h2><div id="loginForm">    <input type="text" id="username" placeholder="Username">    <input type="password" id="password" placeholder="Password">    <button onclick="login()">Login</button></div><div id="logoutSection" style="display:none;">    <p>Logged in as: <span id="user"></span></p>    <div class="token-display">        <strong>JWT Token:</strong>        <p id="jwtToken" style="margin: 5px 0;"></p>    </div>    <p>Browser ID: <span id="browserId"></span></p>    <div class="counter">        Counter: <span id="counter">0</span>    </div>    <button class="increment" onclick="incrementCounter()">Increment Counter</button>    <button class="logout" onclick="logout(false)">Logout from this browser</button>    <button class="logout" onclick="logout(true)" style="background-color: #bd2130;">Logout from all browsers</button></div><p id="message"></p><script>    const API_URL = "http://localhost:8080/v1/auth";    function getBrowserId() {        let browserId = localStorage.getItem('browserId');        if (!browserId) {            browserId = 'browser_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);            localStorage.setItem('browserId', browserId);        }        return browserId;    }    function updateCounter(count) {        document.getElementById("counter").textContent = count;    }    async function incrementCounter() {        const token = localStorage.getItem("jwtToken");        if (!token) return;        try {            const response = await fetch(`${API_URL}/increment`, {                method: "POST",                headers: { "Content-Type": "application/json" },                body: JSON.stringify({ token })            });            const data = await response.json();            if (data.success) {                updateCounter(data.count);                // Broadcast counter update to other tabs                localStorage.setItem('counterUpdate', data.count.toString());            }        } catch (error) {            console.error("Error incrementing counter:", error);        }    }    async function login() {        const username = document.getElementById("username").value;        const password = document.getElementById("password").value;        const browserId = getBrowserId();        try {            console.log('Attempting login with:', { username, browserId }); // Debug log            const response = await fetch(`${API_URL}/login`, {                method: "POST",                headers: { "Content-Type": "application/json" },                body: JSON.stringify({ username, password, browserId })            });            console.log('Response status:', response.status); // Debug log            const data = await response.json();            console.log('Login response data:', data); // Debug log            if (data.token) {                localStorage.setItem("jwtToken", data.token);                localStorage.setItem("username", data.username);                updateCounter(data.counter);                showLogout();                localStorage.setItem('authEvent', Date.now().toString());            } else {                console.log('No token in response'); // Debug log                document.getElementById("message").innerText = "Invalid credentials!";            }        } catch (error) {            console.error("Detailed login error:", error); // More detailed error logging            document.getElementById("message").innerText = "Login failed!";        }    }    async function checkAuth() {        const token = localStorage.getItem("jwtToken");        const browserId = getBrowserId();        if (!token) {            return showLogin();        }        try {            const response = await fetch(`${API_URL}/validate?token=${token}&browserId=${browserId}`);            const data = await response.json();            if (data.token) {                updateCounter(data.counter);                showLogout();            } else {                localStorage.removeItem("jwtToken");                localStorage.removeItem("username");                showLogin();            }        } catch (error) {            localStorage.removeItem("jwtToken");            localStorage.removeItem("username");            showLogin();        }    }    async function logout(logoutAll) {        const username = localStorage.getItem("username");        const browserId = getBrowserId();        try {            const response = await fetch(`${API_URL}/logout`, {                method: "POST",                headers: { "Content-Type": "application/json" },                body: JSON.stringify({ username, browserId, logoutAll })            });            const data = await response.json();            if (data.success) {                localStorage.removeItem("jwtToken");                localStorage.removeItem("username");                if (logoutAll) {                    localStorage.removeItem("browserId");                }                showLogin();                // Notify other tabs about the logout                localStorage.setItem('authEvent', Date.now().toString());            }        } catch (error) {            console.error("Error:", error);            document.getElementById("message").innerText = "Logout failed!";        }    }    function showLogout() {            try {                const user = localStorage.getItem("username");                const token = localStorage.getItem("jwtToken");                const browserId = getBrowserId();                const userElement = document.getElementById("user");                const jwtTokenElement = document.getElementById("jwtToken");                const browserIdElement = document.getElementById("browserId");                const loginFormElement = document.getElementById("loginForm");                const logoutSectionElement = document.getElementById("logoutSection");                const messageElement = document.getElementById("message");                // Check if all elements exist                if (!userElement || !jwtTokenElement || !browserIdElement ||                    !loginFormElement || !logoutSectionElement || !messageElement) {                    console.error("Some required DOM elements are missing");                    return;                }                userElement.innerText = user;                jwtTokenElement.innerText = token;                browserIdElement.innerText = browserId;                loginFormElement.style.display = "none";                logoutSectionElement.style.display = "block";                messageElement.innerText = "";            } catch (error) {                console.error("Error in showLogout:", error);            }        }    function showLogin() {        document.getElementById("loginForm").style.display = "block";        document.getElementById("logoutSection").style.display = "none";        document.getElementById("message").innerText = "";        document.getElementById("counter").textContent = "0";    }    // Listen for auth changes and counter updates in other tabs    window.addEventListener('storage', (event) => {        if (event.key === 'authEvent') {            checkAuth();        } else if (event.key === 'counterUpdate') {            updateCounter(parseInt(event.newValue));        }    });    // Check auth on page load    document.addEventListener('DOMContentLoaded', checkAuth);</script></body></html>